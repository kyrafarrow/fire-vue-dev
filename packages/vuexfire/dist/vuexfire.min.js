/*!
 * vuexfire v2.0.0
 * (c) 2017 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VuexFire=e.VuexFire||{})}(this,function(e){"use strict";function t(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){return"function"==typeof e.key?e.key():e.key}function i(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function c(e){var t=e.val(),i=n(t)?t:{".value":t};return i[".key"]=r(e),i}function o(e){var t=e.key,n=e.source,r=e.cancelCallback,i=e.commit,o=e.state;return{value:n.on("value",function(e){i(b,{type:d,key:t,record:c(e),state:o})},r)}}function u(e){var n=e.key,i=e.source,o=e.cancelCallback,u=e.commit,a=e.state;u(b,{type:l,state:a,key:n});var s=i.on("child_added",function(e,r){var i=a[n],o=r?t(i,r)+1:0;u(b,{type:y,state:a,key:n,index:o,record:c(e)})},o),f=i.on("child_removed",function(e){var i=a[n],c=t(i,r(e));u(b,{type:p,state:a,key:n,index:c})},o);return{child_added:s,child_changed:i.on("child_changed",function(e){var i=a[n],o=t(i,r(e));u(b,{type:v,state:a,key:n,index:o,record:c(e)})},o),child_removed:f,child_moved:i.on("child_moved",function(e,i){var o=a[n],s=t(o,r(e)),f=i?t(o,i)+1:0;f+=s<f?-1:0,u(b,{type:k,state:a,key:n,index:s,newIndex:f,record:c(e)})},o)}}function a(e){var t=e.state,r=e.commit,c=e.key,a=e.source,f=e.options.cancelCallback;if(!n(a))throw new Error("VuexFire: invalid Firebase binding source.");if(!(c in t))throw new Error("VuexFire: cannot bind undefined property '"+c+"'. Define it on the state first.");var d=h.get(r);d||(d={sources:Object.create(null),listeners:Object.create(null)},h.set(r,d)),c in d.sources&&s({commit:r,key:c}),d.sources[c]=i(a);var l;l=t[c]&&"length"in t[c]?u({key:c,source:a,cancelCallback:f,commit:r,state:t}):o({key:c,source:a,cancelCallback:f,commit:r,state:t}),d.listeners[c]=l}function s(e){var t=e.commit,n=e.key,r=h.get(t);if(r||(r={sources:Object.create(null),listeners:Object.create(null)},h.set(t,r)),!(n in r.sources))throw new Error("VuexFire: cannot unbind '"+n+"' because it wasn't bound.");var i=r.sources[n],c=r.listeners[n];for(var o in c)i.off(o,c[o]);delete r.sources[n],delete r.listeners[n]}function f(e){return function(t,n){var r=t.state,i=t.commit;t.bindFirebaseRef=function(e,t,n){return void 0===n&&(n={}),a({state:r,commit:i,key:e,source:t,options:n})},t.unbindFirebaseRef=function(e){return s({commit:i,key:e})},e(t,n)}}var d="vuexfire/OBJECT_VALUE",l="VUEXFIRE_ARRAY_INITIALIZE",y="vuexfire/ARRAY_ADD",v="vuexfire/ARRAY_CHANGE",k="vuexfire/ARRAY_MOVE",p="vuexfire/ARRAY_REMOVE",b="vuexfire/MUTATION",m={};m[d]=function(e,t){var n=t.key,r=t.record;e[n]=r},m[l]=function(e,t){e[t.key]=[]},m[y]=function(e,t){var n=t.key,r=t.index,i=t.record;e[n].splice(r,0,i)},m[v]=function(e,t){var n=t.key,r=t.index,i=t.record;e[n].splice(r,1,i)},m[k]=function(e,t){var n=t.key,r=t.index,i=(t.record,t.newIndex),c=e[n];c.splice(i,0,c.splice(r,1)[0])},m[p]=function(e,t){var n=t.key,r=t.index;e[n].splice(r,1)};var x={};x[b]=function(e,t){m[t.type](t.state,t)};var h=new WeakMap;e.firebaseMutations=x,e.firebaseAction=f,Object.defineProperty(e,"__esModule",{value:!0})});