!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VuexFire=t():e.VuexFire=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){function i(e){return"function"==typeof e.key?e.key():e.key}function o(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function r(e){return"[object Object]"===Object.prototype.toString.call(e)}function s(e){var t=e.val(),n=r(t)?t:{".value":t};return n[".key"]=i(e),n}function u(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}function c(e,t,n){var i=!1,s=null,u=p.modules.getModuleFromKey(t),c=p.modules.getKey(t);if(r(n)&&n.hasOwnProperty("source")&&(i=n.asObject,s=n.cancelCallback,n=n.source),!r(n))throw new Error("VuexFire: invalid Firebase binding source.");if(!p.vuex.isKeyInState(e.$store.state,u,c))throw new Error('VuexFire: bind failed: "'+(u&&u+"/"||"")+c+'" is not defined in the store state');var l=o(n);e.$firebaseRefs[t]=l,e._firebaseSources[t]=n,i?f(e,t,u,c,n,s):a(e,t,u,c,n,s)}function a(e,t,n,o,r,c){var a=e.$store.state;p.vuex.initWithValue(a,n,o,[]);const f=r.on("child_added",function(t,i){const r=p.vuex.get(a,n,o),c=i?u(r,i)+1:0;e.$store.commit(p.vuex.getMutationName(n,v),{key:o,index:c,record:s(t)})},c),l=r.on("child_removed",function(t){const r=p.vuex.get(a,n,o),s=u(r,i(t));e.$store.commit(p.vuex.getMutationName(n,h),{key:o,index:s})},c),d=r.on("child_changed",function(t){const r=p.vuex.get(a,n,o),c=u(r,i(t));e.$store.commit(p.vuex.getMutationName(n,y),{key:o,index:c,record:s(t)})},c),m=r.on("child_moved",function(t,r){const c=p.vuex.get(a,n,o),f=u(c,i(t));var l=r?u(c,r)+1:0;l+=f<l?-1:0,e.$store.commit(p.vuex.getMutationName(n,g),{key:o,index:f,newIndex:l,record:s(t)})},c);e._firebaseListeners[t]={child_added:f,child_removed:l,child_changed:d,child_moved:m}}function f(e,t,n,i,o,r){const u=o.on("value",function(t){e.$store.commit(p.vuex.getMutationName(n,x),{key:i,record:s(t)})},r);e._firebaseListeners[t]={value:u}}function l(e,t){var n=p.modules.getModuleFromKey(t),i=e._firebaseSources&&e._firebaseSources[t];if(!i)throw new Error('VuexFire: unbind failed: "'+t+'" is not bound to a Firebase reference.');e.$store.commit(p.vuex.getMutationName(n,x),{key:t,record:null});const o=e._firebaseListeners[t];for(var r in o)i.off(r,o[r]);e.$firebaseRefs[t]=null,e._firebaseSources[t]=null,e._firebaseListeners[t]=null}function d(e){if(!e.$firebaseRefs){if(e.$firebaseRefs=Object.create(null),e._firebaseSources=Object.create(null),e._firebaseListeners=Object.create(null),!e.$store)throw new Error("VuexFire: missing Vuex. Install Vuex before VuexFire");e.$store.commit||(b(e.$store),e.$store.commit=e.$store.dispatch)}}function m(e){const t=Number(e.version.split(".")[0]);if(t>=2)e.mixin({beforeCreate:_});else{const n=e.prototype._init;e.prototype._init=function(e){e=e||{},e.init=e.init?[_].concat(e.init):_,n.call(this,e)}}e.mixin($);const i=e.config.optionMergeStrategies;i.firebase=i.methods,e.prototype.$bindAsObject=function(e,t,n){d(this),c(this,e,{source:t,asObject:!0,cancelCallback:n})},e.prototype.$bindAsArray=function(e,t,n){d(this),c(this,e,{source:t,cancelCallback:n})},e.prototype.$unbind=function(e){l(this,e)}}function b(e){for(var t in m.mutations)e._mutations[t]=m.mutations[t]}var p=n(2);const x="VUEXFIRE/objectValue",y="VUEXFIRE/arrayChange",v="VUEXFIRE/arrayAdd",h="VUEXFIRE/arrayRemove",g="VUEXFIRE/arrayMove",$={beforeDestroy:function(){if(this.$firebaseRefs){for(var e in this.$firebaseRefs)this.$firebaseRefs[e]&&this.$unbind(e);this.$firebaseRefs=null,this._firebaseSources=null,this._firebaseListeners=null}}},_=function(){const e=this.$options.firebase;if(e){d(this);for(var t in e)c(this,t,e[t])}};m.mutations={},m.mutations[x]=function(e,t){e[t.key]=t.record},m.mutations[y]=function(e,t){e[t.key].splice(t.index,1,t.record)},m.mutations[v]=function(e,t){e[t.key].splice(t.index,0,t.record)},m.mutations[h]=function(e,t){e[t.key].splice(t.index,1)},m.mutations[g]=function(e,t){const n=e[t.key];n.splice(t.newIndex,0,n.splice(t.index,1)[0])},m.moduleMutations=function(e){return Object.keys(m.mutations).reduce(function(t,n){return t[e.replace(".","/")+"/"+n]=m.mutations[n],t},{})},e.exports=m,"undefined"!=typeof window&&window.Vue&&m(window.Vue)},function(e,t,n){t.modules=n(3),t.vuex=n(4)},function(e,t){t.getModuleFromKey=function(e){var t=e.split(".");return t.slice(0,t.length-1).reduce(function(e,t){return e?e+"/"+t:t},"")},t.getKey=function(e){var t=e.split(".");return t[t.length-1]||""}},function(e,t){function n(e,t){return t.reduce(function(e,t){return e[t]},e)}t.isKeyInState=function(e,t,i){return void 0!==(t?n(e,t.split("/"))[i]:e[i])},t.initWithValue=function(e,t,i,o){t?n(e,t.split("/"))[i]=o:e[i]=o},t.get=function(e,t,i){return t?n(e,t.split("/"))[i]:e[i]},t.getMutationName=function(e,t){return e?e+"/"+t:t}}])});