<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>VueFirex Todo App Demo</title>
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/vue/1.0.26/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/vuex/0.8.2/vuex.js"></script>
    <script src="../../dist/vuefirex.js"></script>
  </head>
  <body>

    <div id="app">
      <ul>
        <li v-for="item in items" track-by=".key">
          {{ item.text }}
          <button @click="removeTodo(item['.key'])">X</button>
        </li>
      </ul>
      <form @submit.prevent="addTodo">
        <input v-model="newTodo">
        <button>Add #{{ items.length }}</button>
      </form>
    </div>

    <script>
    /* global Vue, Firebase */
    var config = {
      apiKey: "AIzaSyDs3VTO0osu4j_gZlsxvI4QUGD89w4ZuBs",
      databaseURL: "https://vuefirexdemo.firebaseio.com",
    }
    var firebaseApp = firebase.initializeApp(config)
    var db = firebaseApp.database()
    var itemsRef = db.ref('items')

    var state = {
      items: null
    }

    var mutations = {}

    var store = new Vuex.Store({state: state, mutations: mutations})

    var vm = new Vue({
      el: '#app',
      store: store,
      vuex: {
        getters: {
          items: function (state) { return state.items }
        }
      },
      firebase: {
        items: db.ref('items')
      },
      data: {
        newTodo: ''
      },
      firebase: {
        items: itemsRef.limitToLast(25)
      },
      methods: {
        removeTodo: function (key) {
          itemsRef.child(key).remove()
        },
        addTodo: function () {
          if (this.newTodo.trim()) {
            itemsRef.push({
              text: this.newTodo
            })
            this.newTodo = ''
          }
        }
      }
    })
    </script>
  </body>
</html>
